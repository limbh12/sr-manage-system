# 변경 이력 - 2025년 12월 23일

## 요약

### OPEN API 현황조사 기능 개선
- 담당자 직급/처리상태 저장 오류 수정
- 담당자 목록을 전체 사용자로 변경 (관리자만 → 전체)
- 담당자 필수값 처리 및 삭제 기능 추가
- 목록 항목 변경 및 행 클릭 시 상세화면 이동
- "현황조사 관리" 섹션 최상단 분리

### SR 자동등록 개선
- SR 제목에 방식(희망전환방식) 포함
- SR 상태를 RESOLVED(해결)로 변경
- 처리내용에 모든 현황조사 항목 반영

### 다크모드 가독성 개선
- 현황조사 관리/AI 검색 임베딩 영역 배경색 조정
- 모달 헤더 제목 및 폼 라벨 색상 개선

---

## 상세 변경 내역

### 1. OPEN API 현황조사 기능 개선

#### 1.1 담당자 직급 저장 오류 수정
- **파일**: `backend/src/main/java/com/srmanagement/service/OpenApiSurveyService.java`
- **내용**: `updateSurvey` 메서드에 `survey.setContactPosition(request.getContactPosition())` 추가

#### 1.2 처리상태 저장 오류 수정
- **파일**: `backend/src/main/java/com/srmanagement/service/OpenApiSurveyService.java`
- **내용**:
  - `SurveyStatus` import 추가
  - `updateSurvey` 메서드에 `survey.setStatus(request.getStatus())` 추가

#### 1.3 담당자 목록 전체 사용자로 변경
- **파일**: `frontend/src/components/survey/SurveyForm.tsx`
- **내용**: `getUsers()` (관리자만) → `getUserOptions()` (전체 사용자)로 변경

#### 1.4 담당자 필수값 처리
- **파일**: `frontend/src/components/survey/SurveyForm.tsx`
- **내용**: 담당자 select에 `required` 속성 추가

#### 1.5 현황조사 삭제 기능 추가
- **Backend**:
  - `OpenApiSurveyController.java`: DELETE `/api/surveys/{id}` 엔드포인트 추가
  - `OpenApiSurveyService.java`: `deleteSurvey()` 메서드 추가 (임베딩 삭제 포함)
  - `ContentEmbeddingService.java`: `deleteSurveyEmbeddings()` 메서드 추가
- **Frontend**:
  - `surveyService.ts`: `deleteSurvey()` 함수 추가
  - `SurveyForm.tsx`: 삭제 버튼 및 삭제 로직 구현

#### 1.6 목록 항목 변경
- **파일**: `frontend/src/components/survey/SurveyList.tsx`
- **변경된 항목**: No, 기관명, 부서, 담당자, 시스템명, 현재방식, 희망방식, 조사담당자, 처리상태

#### 1.7 목록 행 클릭 시 상세화면 이동
- **파일**: `frontend/src/components/survey/SurveyList.tsx`
- **내용**: "상세" 버튼 제거, 행 클릭 시 상세화면으로 이동하도록 변경

#### 1.8 현황조사 관리 섹션 분리
- **파일**: `frontend/src/components/survey/SurveyForm.tsx`
- **내용**: 담당자, 처리상태 항목을 "현황조사 관리" 섹션으로 분리하여 폼 최상단에 배치

---

### 2. SR 자동등록 개선

#### 2.1 SR 제목 형식 변경
- **파일**: `backend/src/main/java/com/srmanagement/service/OpenApiSurveyService.java`
- **변경 전**: `[OPEN API 현황조사] 기관명 - 시스템명`
- **변경 후**: `[OPEN API 현황조사] 기관명 - 방식 - 시스템명`
- **적용 위치**: `createSrForNewSurvey()`, `createSrForUpdatedSurvey()` 메서드

#### 2.2 SR 상태 변경
- **파일**: `backend/src/main/java/com/srmanagement/service/OpenApiSurveyService.java`
- **변경 전**: `SrStatus.CLOSED` (종료)
- **변경 후**: `SrStatus.RESOLVED` (해결)

#### 2.3 처리내용에 모든 항목 반영
- **파일**: `backend/src/main/java/com/srmanagement/service/OpenApiSurveyService.java`
- **추가된 메서드**: `buildProcessingDetails()`
- **반영 항목**:
  1. 기본 정보: 기관명, 부서, 담당자명, 직급, 연락처, 이메일, 수신일자, 수신파일명
  2. 시스템 현황: 시스템명, 운영상태, 현재방식, 희망전환방식, 분산형 희망사유
  3. 유지보수 정보: 유지보수 운영, 유지보수 위치, 유지보수 주소, 유지보수 비고
  4. 운영 환경: 운영환경, 서버 위치
  5. 서버 환경: WEB/WAS/DB Server (OS, 타입, 버전)
  6. 개발 환경: 개발언어, 프레임워크 (버전 포함)
  7. 기타: 기타 요청사항, 비고

- **추가된 레이블 변환 메서드**:
  - `getMaintenanceOperationLabel()`: 자체운영, 위탁운영, 혼합운영
  - `getMaintenanceLocationLabel()`: 자체, IDC, 클라우드, 기타
  - `getOperationEnvLabel()`: 온프레미스, 클라우드, 하이브리드

---

### 3. 다크모드 가독성 개선

#### 3.1 현황조사 관리 섹션
- **파일**: `frontend/src/components/survey/SurveyForm.tsx`
- **내용**: 인라인 스타일을 `bg-info-light` CSS 클래스로 변경

#### 3.2 AI 검색 임베딩 섹션 (현황조사)
- **파일**: `frontend/src/components/survey/SurveyForm.tsx`
- **내용**:
  - `bg-info-light` CSS 클래스 적용
  - 텍스트 색상을 CSS 변수로 변경 (`var(--text-primary)`, `var(--text-secondary)` 등)

#### 3.3 AI 검색 임베딩 섹션 (SR 상세)
- **파일**: `frontend/src/components/sr/SrDetail.tsx`
- **내용**: 현황조사와 동일하게 다크모드 지원

#### 3.4 bg-info-light 클래스 다크모드 스타일
- **파일**: `frontend/src/App.css`
- **내용**:
  ```css
  [data-theme='dark'] .bg-info-light {
    background-color: #2d2d2d;
    border: 1px solid #444444;
  }
  ```

#### 3.5 모달 헤더 제목
- **파일**: `frontend/src/App.css`
- **내용**:
  ```css
  [data-theme='dark'] .modal-title {
    color: #ffffff;
  }
  ```

#### 3.6 폼 라벨
- **파일**: `frontend/src/App.css`
- **내용**:
  ```css
  [data-theme='dark'] .form-label {
    color: #ffffff;
  }
  ```

---

## 수정된 파일 목록

### Backend
| 파일 | 수정 내용 |
|------|-----------|
| `OpenApiSurveyService.java` | SR 생성 로직 개선, 처리내용 생성, 삭제 기능, 상태/직급 저장 |
| `OpenApiSurveyController.java` | DELETE 엔드포인트 추가 |
| `ContentEmbeddingService.java` | 현황조사 임베딩 삭제 메서드 추가 |

### Frontend
| 파일 | 수정 내용 |
|------|-----------|
| `SurveyForm.tsx` | 폼 섹션 분리, 삭제 기능, 담당자 필수화, 다크모드 |
| `SurveyList.tsx` | 목록 항목 변경, 행 클릭 이동 |
| `SrDetail.tsx` | 임베딩 영역 다크모드 |
| `surveyService.ts` | deleteSurvey 함수 추가 |
| `App.css` | 다크모드 스타일 (modal-title, form-label, bg-info-light) |
