# 변경 이력 - 2025-12-08

## 다크모드 가독성 대폭 개선

### 개요
SR 관리 시스템의 다크모드에서 텍스트 가독성이 떨어지는 문제를 전면적으로 개선했습니다. 특히 SR 상세 모달의 "요청사항", "처리내용", "이력 및 댓글" 섹션에서 텍스트가 보이지 않거나 대비가 낮아 읽기 어려운 문제를 해결했습니다.

---

## 주요 변경 사항

### 1. Markdown 콘텐츠 다크모드 개선

#### 문제점
- SR 상세 모달의 "요청사항"과 "처리내용" 섹션에서 ReactMarkdown으로 렌더링된 텍스트가 다크모드에서 보이지 않음
- ReactMarkdown이 자체 스타일을 적용하여 테마 색상이 무시됨

#### 해결방법
- `App.css`에 `.markdown-body` 클래스에 대한 `!important` 규칙 추가
- 모든 markdown 요소(p, li, div, span, code, pre)에 명시적으로 다크모드 텍스트 색상 강제 적용

```css
[data-theme='dark'] .markdown-body {
  color: var(--text-primary) !important;
}

[data-theme='dark'] .markdown-body p,
[data-theme='dark'] .markdown-body li,
[data-theme='dark'] .markdown-body div,
[data-theme='dark'] .markdown-body span,
[data-theme='dark'] .markdown-body code,
[data-theme='dark'] .markdown-body pre {
  color: var(--text-primary) !important;
}
```

#### 배경색 밝기 조정
- 더 나은 대비를 위해 배경색 밝기 증가
  - `bg-history-detail`: `#2a2a2a` → `#353535`
  - `bg-info-light`: `#1a2942` → `#2a3a4a`
  - 보더 색상도 함께 밝게 조정

#### 적용 파일
- `frontend/src/App.css`
- `frontend/src/components/sr/SrDetail.tsx`

---

### 2. SR 이력 타임라인 다크모드 개선

#### 문제점
- SrHistoryList 컴포넌트에 하드코딩된 색상 값이 다수 존재
- 타임라인, 배지, 날짜, Diff 뷰 등 모든 요소가 라이트모드 색상으로 고정
- 다크모드에서 대비가 부족하거나 텍스트가 보이지 않음

#### 해결방법

**새로운 CSS 유틸리티 클래스 추가** (`App.css`)

| 클래스명 | 용도 | 라이트모드 | 다크모드 |
|---------|------|-----------|---------|
| `.text-muted` | 보조 텍스트 | `#888888` | `#999999` |
| `.text-content` | 본문 텍스트 | `#444444` | `#d0d0d0` |
| `.text-empty` | 빈 상태 텍스트 | `#999999` | `#707070` |
| `.badge-history` | 이력 타입 배지 | `#f0f0f0` / `#555` | `#3a3a3a` / `#c0c0c0` |
| `.timeline-dot-comment` | 댓글 타임라인 점 | `#666666` | `#999999` |
| `.timeline-dot-change` | 변경 타임라인 점 | `#1976d2` | `#42a5f5` |
| `.timeline-border` | 타임라인 세로선 | `#e0e0e0` | `#4a4a4a` |
| `.bg-diff-removed` | Diff 변경 전 배경 | `#fff0f0` | `#3d2020` |
| `.bg-diff-added` | Diff 변경 후 배경 | `#f0fff4` | `#1a3d20` |
| `.text-diff-removed` | Diff 변경 전 레이블 | `#d32f2f` | `#ff6b6b` |
| `.text-diff-added` | Diff 변경 후 레이블 | `#2e7d32` | `#69db7c` |
| `.text-diff-content` | Diff 내용 텍스트 | `#333333` | `#e0e0e0` |
| `.link-primary` | 링크 색상 | `#1976d2` | `#42a5f5` |

**SrHistoryList.tsx 리팩토링**

모든 하드코딩된 색상을 CSS 클래스로 교체:

```tsx
// Before
<div style={{ borderLeft: '2px solid #e0e0e0' }}>
  <div style={{ backgroundColor: '#666' }}></div>
  <div style={{ color: '#666' }}>{date}</div>
  <span style={{ backgroundColor: '#f0f0f0', color: '#555' }}>댓글</span>
  <div style={{ color: '#444' }}>{content}</div>
</div>

// After
<div className="timeline-border">
  <div className="timeline-dot-comment"></div>
  <div className="text-secondary">{date}</div>
  <span className="badge-history">댓글</span>
  <div className="text-content">{content}</div>
</div>
```

**Diff 뷰 개선**

```tsx
// Before
<div style={{ backgroundColor: '#fff0f0' }}>
  <div style={{ color: '#d32f2f' }}>변경 전</div>
  <div style={{ color: '#333' }}>{previousValue}</div>
</div>

// After
<div className="bg-diff-removed">
  <div className="text-diff-removed">변경 전</div>
  <div className="text-diff-content">{previousValue}</div>
</div>
```

#### 적용 파일
- `frontend/src/App.css` (117줄 추가)
- `frontend/src/components/sr/SrHistoryList.tsx` (68줄 수정)

---

## 3. Spring Security 정적 리소스 접근 설정 개선

### 문제점
- 프론트엔드 빌드 파일(JS, CSS)을 Spring Boot의 static 디렉토리에 배포 시 404 오류 발생
- 기존 설정: `/**/*.js`, `/**/*.css` 패턴이 Spring Security에서 오류 유발
- 에러: `PatternParseException: No more pattern data allowed after {*...} or ** pattern element`

### 원인
Spring의 AntPathMatcher는 `**` 뒤에 추가 경로 세그먼트를 허용하지 않습니다.

```java
// 잘못된 패턴 (오류 발생)
.requestMatchers("/**/*.js", "/**/*.css", "/**/*.png")
```

### 해결방법
URL 패턴을 Spring Security가 허용하는 형식으로 분리:

```java
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
        .authorizeHttpRequests(auth -> auth
            // 루트 및 메인 페이지
            .requestMatchers("/", "/index.html", "/favicon.ico").permitAll()

            // 정적 리소스 디렉토리
            .requestMatchers("/static/**", "/assets/**").permitAll()

            // 루트 레벨 정적 파일
            .requestMatchers("/*.js", "/*.css", "/*.png", "/*.svg", "/*.ico").permitAll()

            // 나머지 요청은 인증 필요
            .anyRequest().authenticated()
        )
        // ... JWT 필터 등 기타 설정
}
```

### 패턴 설명
1. **`/`, `/index.html`, `/favicon.ico`**: 메인 페이지와 파비콘 직접 접근
2. **`/static/**`, `/assets/**`**: Vite 빌드 결과물 디렉토리 전체 허용
3. **`/*.js`, `/*.css` 등**: 루트 레벨 정적 파일 허용

### 효과
- ✅ 프론트엔드를 `backend/src/main/resources/static/`에 배포 가능
- ✅ 정적 리소스에 대한 인증 없이 접근 가능
- ✅ Spring Boot 단일 JAR 배포 지원
- ✅ backend_test_script.sh 테스트 전체 통과

### 적용 파일
- `backend/src/main/java/com/srmanagement/config/SecurityConfig.java`

### 관련 설정
- `.gitignore`에 `backend/src/main/resources/static/` 추가 (빌드 결과물 제외)
- 프론트엔드 빌드 시 `npm run build`로 생성된 `dist/` 내용을 static으로 복사

---

## 이전 세션에서 완료된 다크모드 개선 사항

### 1. .gitignore 업데이트
- `backend/src/main/resources/static/` 추가 (프론트엔드 빌드 결과물 제외)

### 2. Readonly/Disabled 필드 다크모드 개선
- 입력 필드의 readonly/disabled 상태에서 텍스트 가독성 개선
- 적절한 투명도와 색상 적용

### 3. 조회 화면 배경 다크모드 개선
- SurveyList, UserEditModal 등의 흰색 배경 문제 해결
- `bg-highlight`, `bg-section` 등 유틸리티 클래스 활용

### 4. SR 상세 정보 모달 다크모드 개선
- SrDetail, OpenApiSurveyInfoCard의 배경/텍스트 색상 개선
- `bg-history-detail`, `bg-info-light`, `text-secondary` 클래스 활용

---

## 기술적 세부사항

### CSS 변수 시스템
모든 다크모드 스타일은 `[data-theme='dark']` 선택자를 사용하여 구현되었습니다.

```css
/* 라이트모드 */
.text-content {
  color: #444444;
}

/* 다크모드 */
[data-theme='dark'] .text-content {
  color: #d0d0d0;
}
```

### 색상 대비 기준
- 다크모드 배경색: 더 어두운 회색 계열 사용
- 다크모드 텍스트: 밝은 회색 계열로 높은 대비 확보
- WCAG 2.1 AA 기준 (최소 4.5:1 대비율) 충족

### !important 사용 정당화
ReactMarkdown과 같은 외부 라이브러리가 자체 스타일을 주입하는 경우, `!important`를 사용하여 다크모드 스타일을 강제 적용했습니다. 이는 필요한 경우에만 제한적으로 사용했습니다.

---

## 테스트 결과

### 개선된 영역
1. ✅ SR 상세 모달 - 요청사항 섹션 (Markdown)
2. ✅ SR 상세 모달 - 처리내용 섹션 (Markdown)
3. ✅ SR 상세 모달 - 이력 및 댓글 섹션 (Timeline)
4. ✅ SR 상세 모달 - 변경 이력 Diff 뷰
5. ✅ 설문조사 목록 - 선택된 항목 배경
6. ✅ 사용자 수정 모달 - Readonly 필드
7. ✅ 설문조사 폼 - 서버 섹션 배경

### 사용자 피드백
모든 다크모드 가독성 문제가 해결되어 SR 상세 모달의 모든 섹션에서 텍스트가 명확하게 보입니다.

---

## 관련 커밋

1. `56aad6b` - 운영 가이드: 프론트엔드 Apache/Nginx 예시 및 Spring Boot 내장 배포 방법 추가
2. `3e26497` - 운영 환경 구성(H2 파일 모드, 시작 스크립트) 및 SR 상세 모달 UI 개선
3. `8d1f411` - 개인정보 암호화 적용(AES-256) 및 검색 로직 개선, 관련 문서 추가
4. `423cf4d` - Markdown 영역 다크모드 가독성 대폭 개선
5. `14f9c7e` - SR 이력 타임라인 다크모드 가독성 대폭 개선 (현재)

---

## 향후 개선 사항

### 권장 사항
1. **다른 컴포넌트 검토**: 아직 확인하지 않은 컴포넌트에서도 하드코딩된 색상이 있는지 점검
2. **색상 팔레트 문서화**: 현재 사용 중인 모든 다크모드 색상을 문서화하여 일관성 유지
3. **자동화된 테스트**: 다크모드 대비 비율을 자동으로 검증하는 테스트 추가 고려
4. **사용자 설정**: 다크모드 색상 강도 조절 옵션 추가 검토

### 알려진 제한사항
- ReactMarkdown의 일부 플러그인이 추가 스타일을 주입할 경우 추가 `!important` 규칙이 필요할 수 있음
- 브라우저 기본 스타일이 적용되는 요소는 개별적으로 오버라이드 필요

---

## 참고 자료

- **관련 문서**: `docs/HISTORY_20251206.md`
- **프로젝트 가이드**: `CLAUDE.md`
- **API 명세**: `docs/API.md`
- **데이터베이스 설계**: `docs/DATABASE.md`

---

## 변경 파일 요약

| 파일 | 변경 라인 | 주요 변경 내용 |
|------|----------|--------------|
| `frontend/src/App.css` | +117 | 다크모드 유틸리티 클래스 대량 추가 |
| `frontend/src/components/sr/SrHistoryList.tsx` | ~68 | 하드코딩 색상 → CSS 클래스 전환 |
| `frontend/src/components/sr/SrDetail.tsx` | ~10 | Markdown 영역 클래스 적용 |
| `frontend/src/components/sr/OpenApiSurveyInfoCard.tsx` | ~5 | 배경/텍스트 클래스 적용 |
| `frontend/src/components/survey/SurveyList.tsx` | ~3 | 배경 클래스 적용 |
| `frontend/src/components/user/UserEditModal.tsx` | ~2 | 인라인 스타일 제거 |
| `.gitignore` | +1 | static 디렉토리 제외 |
| `backend/.../SecurityConfig.java` | ~10 | URL 패턴 수정 |

**총 변경**: 8개 파일, 약 216줄 추가/수정

---

## 작성자
- Claude Sonnet 4.5 (Claude Code)
- 날짜: 2025-12-08
